.\" Automatically generated by Pod::Man v1.37, Pod::Parser v1.14
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sh \" Subsection heading
.br
.if t .Sp
.ne 5
.PP
\fB\\$1\fR
.PP
..
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  | will give a
.\" real vertical bar.  \*(C+ will give a nicer C++.  Capital omega is used to
.\" do unbreakable dashes and therefore won't be available.  \*(C` and \*(C'
.\" expand to `' in nroff, nothing in troff, for use with C<>.
.tr \(*W-|\(bv\*(Tr
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
'br\}
.\"
.\" If the F register is turned on, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.Sh), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.if \nF \{\
.    de IX
.    tm Index:\\$1\t\\n%\t"\\$2"
..
.    nr % 0
.    rr F
.\}
.\"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.hy 0
.if n .na
.\"
.\" Accent mark definitions (@(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2).
.\" Fear.  Run.  Save yourself.  No user-serviceable parts.
.    \" fudge factors for nroff and troff
.if n \{\
.    ds #H 0
.    ds #V .8m
.    ds #F .3m
.    ds #[ \f1
.    ds #] \fP
.\}
.if t \{\
.    ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.    ds #V .6m
.    ds #F 0
.    ds #[ \&
.    ds #] \&
.\}
.    \" simple accents for nroff and troff
.if n \{\
.    ds ' \&
.    ds ` \&
.    ds ^ \&
.    ds , \&
.    ds ~ ~
.    ds /
.\}
.if t \{\
.    ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.    ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.    ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.    ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.    ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.    ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.\}
.    \" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.    \" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.    \" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.    ds : e
.    ds 8 ss
.    ds o a
.    ds d- d\h'-1'\(ga
.    ds D- D\h'-1'\(hy
.    ds th \o'bp'
.    ds Th \o'LP'
.    ds ae ae
.    ds Ae AE
.\}
.rm #[ #] #H #V #F C
.\" ========================================================================
.\"
.IX Title "BUFFINDEXED.CONF 5"
.TH BUFFINDEXED.CONF 5 "2004-05-27" "INN 2.5.0" "InterNetNews Documentation"
.SH "NAME"
buffindexed.conf \- Configuration for the buffindexed overview method
.SH "DESCRIPTION"
.IX Header "DESCRIPTION"
\&\fIbuffindexed.conf\fR, found in \fIpathetc\fR, specifies the buffers that the
buffindexed overview method should use.  It is required if the server uses
buffindexed (as configured by the \fIovmethod\fR parameter in \fIinn.conf\fR).
.PP
Buffindexed uses pre-built buffer files to store overview data and indexes
to that data.  The buffers are divided into 8KB internally, and a given
block is used either for overview data or for index data.  A block is
always allocated to a single newsgroup and is never shared among
newsgroups.
.PP
In addition to the buffers, buffindexed also stores information in a file
named \fIgroup.index\fR in \fIpathdb\fR.  It contains information about each
newsgroup:  the pointer to the index block for the newsgroup, the high
mark, the low mark, the flag of the group, the number of articles, and so
forth.  This file is created automatically when all buffers are
initialized and should not be manually edited.
.PP
Buffindexed buffers are of fixed size, so buffindexed will never use more
space than what is available in those buffers.  If all buffers are full,
\&\fBinnd\fR will throttle when it attempts to store overview information for
any additional articles until space is freed (with \fBexpireover\fR, for
instance) or another buffer is added.  This is unlike the \s-1CNFS\s0 storage
method.
.PP
You can see the current usage of the buffers with the \fB\-o\fR option to
\&\fBinndf\fR.
.PP
In the \fIbuffindexed.conf\fR file, blank lines and lines beginning with a
number sign (\f(CW\*(C`#\*(C'\fR) are ignored.  All other lines must be of the format:
.PP
.Vb 1
\&    <index>:<filename>:<size>
.Ve
.PP
The order of lines is not significant.
.PP
<index> is the index of this overview buffer and must be unique.  Other
than that constraint, it can be any number between 0 and 65535.
.PP
<filename> is the path to the buffer.  The length of the path should not
be longer than 63 characters.
.PP
<size> is the length of the buffer in kilobytes (1KB = 1024 byte).  If
<filename> does not specify a special device, the file size of the buffer
must be <size> * 1024 bytes.  If it does specify a special device, that
device must have at least <size> space available.  Buffers over 2GB are
not supported (regardless of whether \s-1INN\s0 was compiled with large file
support); this limitation may be fixed in the future.  For more
information on setting up the buffers, see \*(L"\s-1CREATING\s0 \s-1BUFFERS\s0\*(R".
.PP
When you first start \fBinnd\fR with everything configured properly, you
should see messages like this in \fIpathlog\fR/news.notice:
.PP
.Vb 2
\&    Aug 27 00:00:00 kevlar innd: buffindexed: No magic cookie found
\&        for buffindexed 0, initializing
.Ve
.PP
You \s-1MUST\s0 recreate overview completely using \fBmakehistory\fR if you remove
or replace buffers.  However, new buffers can be added without any special
care (other than restarting \fBinnd\fR after modifying \fIbuffindexed.conf\fR).
If you need to rebuild overview, you should zero all of the buffers first.
.SH "CREATING BUFFERS"
.IX Header "CREATING BUFFERS"
There are two methods to create a new buffindexed buffer:
.IP "1." 4
Create a large file on top of a regular file system.  The easiest way to
do this is probably with \fIdd\fR\|(1), using a command like:
.Sp
.Vb 1
\&    dd if=/dev/zero of=/path/to/cycbuff bs=1024 count=<size>
.Ve
.Sp
where <size> is the size from the relevant line in \fIbuffindexed.conf\fR.
.Sp
This is the simplest method, but has the disadvantage that very large
files on regular file systems can be fairly slow to access, particularly
at the end of the file, and \s-1INN\s0 incurs unnecessary file system overhead
when accessing the buffer.
.IP "2." 4
Use block devices directly.  If your operating system allows you to call
\&\fImmap()\fR on block devices (Solaris and recent versions of Linux do, FreeBSD
at last report does not), this method can avoid all of the native file
system overhead.  Note, however, that Solaris has problems with byte range
locking on block devices, and therefore this method should not be used on
Solaris.
.Sp
Partition the disk to make each partition equal to or smaller than 2GB.
If you're using Solaris, set up your partitions to avoid the first
cylinder of the disk (or otherwise the buffindexed header will overwrite
the disk partition table and render the buffers inaccessible).  Then,
create device files for each block device you're going to use.
.Sp
It's not recommended to use the block device files in \fI/dev\fR, since the
news system doesn't have permission to write to them and changing the
permissions of the system device files may affect something else.
Instead, use \fImknod\fR\|(1) to create a new set of block devices (in somewhere
like \fIpathspool\fR/overview that's only writable by the news user).  To do
this, run \f(CW\*(C`ls \-Ll\*(C'\fR on the devices in \fI/dev\fR that correspond to the block
devices that you want to use.  The major and minor device numbers are in
the fifth and sixth columns (right before the date), respectively.  Then
run mknod like:
.Sp
.Vb 1
\&    mknod <filename> b <major> <minor>
.Ve
.Sp
where <filename> is the path to the device to create (matching the
<filename> part of the buffindexed configuration line) and <major> and
<minor> are the major and minor device numbers as discovered above.
.Sp
Here's a short script to do this when given the path to the system device
file as an argument:
.Sp
.Vb 8
\&    #!/bin/sh
\&    base=`echo "$1" | sed 's%.*/%%'`
\&    major=`ls -Ll "$1" | awk '{print $5}' | tr -d ,`
\&    minor=`ls -Ll "$1" | awk '{print $6}`
\&    mkdir -p /usr/local/news/spool/overview
\&    mknod /usr/local/news/spool/overvew/"$base" b "$major" "$minor"
\&    chown news:news /usr/local/news/spool/overview/"$base"
\&    chmod 644 /usr/local/news/spool/overview/"$base"
.Ve
.Sp
Make sure that the created files are owned by the news user and news
group, as specified at configure time (the default being \f(CW\*(C`news\*(C'\fR for
both).  Also make sure that the permissions on the devices allow the news
user to read and write.
.SH "HISTORY"
.IX Header "HISTORY"
Written by Katsuhiro Kondou <kondou@nec.co.jp> for InterNetNews.
Converted to \s-1POD\s0 by Russ Allbery <rra@stanford.edu>.
.Sp
$Id$
.SH "SEE ALSO"
.IX Header "SEE ALSO"
\&\fIexpireover\fR\|(8),
\&\fIinn.conf\fR\|(5),
\&\fImakehistory\fR\|(8).
